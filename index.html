<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>DIBBA RADAR</title>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#0a0e14">
<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/radar.css">
</head>
<body>

<!-- Full-screen map -->
<div id="map"></div>

<!-- Top bar: branding + legend toggle -->
<div id="topBar" class="top-bar">
    <div class="top-brand">DIBBA<span class="top-brand-accent">RADAR</span></div>
    <button id="legendBtn" class="top-btn" onclick="toggleLegend()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4M12 8h.01"/></svg>
    </button>
    <button id="settingsBtn" class="top-btn" onclick="toggleSettings()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
    </button>
</div>

<!-- Legend overlay -->
<div id="legend" class="legend" style="display:none">
    <div class="legend-title">CAMERA DENSITY</div>
    <div class="legend-row"><span class="legend-line" style="background:#ff1744"></span> Heavy (&lt;1 km gap)</div>
    <div class="legend-row"><span class="legend-line" style="background:#ff6d00"></span> Moderate (1-2.5 km)</div>
    <div class="legend-row"><span class="legend-line" style="background:#ffd600"></span> Light (2.5-5 km)</div>
    <div class="legend-row"><span class="legend-line" style="background:#00e676"></span> Clear (&gt;5 km)</div>
    <div class="legend-sep"></div>
    <div class="legend-title">CAMERAS</div>
    <div class="legend-row"><span class="legend-dot" style="background:#ff1744"></span> 120+ km/h</div>
    <div class="legend-row"><span class="legend-dot" style="background:#ff6d00"></span> 80-119 km/h</div>
    <div class="legend-row"><span class="legend-dot" style="background:#ffd600"></span> &lt;80 km/h</div>
    <div class="legend-row"><span class="legend-dot" style="background:#78909c"></span> Unknown limit</div>
</div>

<!-- Speed widget (map view, Waze-style circle) -->
<div id="speedOverlay" class="speed-widget">
    <div id="speedValue" class="speed-val">--</div>
    <div class="speed-unit">km/h</div>
    <div id="speedLimitBadge" class="speed-limit-badge">--</div>
</div>

<!-- Camera proximity alert -->
<div id="alertBanner" class="alert-banner">
    <div id="alertText" class="alert-text"></div>
    <div id="alertLimit" class="alert-limit"></div>
</div>

<!-- Drive button -->
<button id="startDriveBtn" class="drive-btn" onclick="startDrive()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
    DRIVE
</button>
<button id="stopDriveBtn" class="stop-btn" onclick="stopDrive()">STOP</button>
<button id="centerBtn" class="center-btn" onclick="centerOnMe()">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M12 2v4M12 18v4M2 12h4M18 12h4"/></svg>
</button>

<!-- Slow down flash -->
<div id="slowDownOverlay" class="slow-down-overlay">
    <div class="slow-down-text">SLOW DOWN</div>
</div>

<!-- Off route badge -->
<div id="offRouteBadge" class="off-route-badge">OFF ROUTE</div>

<!-- HUD (driving overlay on top of map) -->
<div id="hudContainer" class="hud" onclick="hudTap(event)">
    <div class="hud-top">
        <div id="hudCamLabel" class="hud-label">CAMERA IN</div>
        <div id="hudCamDist" class="hud-dist">--</div>
        <div class="hud-bar"><div id="hudCamBar" class="hud-bar-fill"></div></div>
    </div>
    <div class="hud-center">
        <div class="hud-speed-wrap">
            <div id="hudSpeed" class="hud-speed hud-speed-ok">--</div>
            <div id="hudLimitBadge" class="hud-limit-badge">--</div>
        </div>
        <div id="hudSpeedUnit" class="hud-unit">km/h</div>
    </div>
    <div class="hud-bottom">
        <canvas id="speedTrendCanvas" class="hud-trend" width="300" height="50"></canvas>
        <div id="hudOffRoute" class="hud-off-route">OFF ROUTE</div>
    </div>
    <button class="hud-btn hud-btn-map" onclick="hudToMap(event)">MAP</button>
    <button class="hud-btn hud-btn-stop" onclick="hudStop(event)">STOP</button>
</div>

<!-- Settings panel -->
<div id="settingsPanel" class="settings-panel" style="display:none">
    <div class="settings-header">
        <span>SETTINGS</span>
        <button onclick="toggleSettings()">x</button>
    </div>
    <div class="settings-body">
        <div class="setting-row">
            <span>Units</span>
            <div class="setting-pills">
                <button class="pill active" id="unitsKmh" onclick="setUnits('kmh')">km/h</button>
                <button class="pill" id="unitsMph" onclick="setUnits('mph')">mph</button>
            </div>
        </div>
        <div class="setting-row">
            <span>Alert Distance</span>
            <div class="setting-pills">
                <button class="pill" id="alertShort" onclick="setAlertDistance('short')">Short</button>
                <button class="pill active" id="alertMedium" onclick="setAlertDistance('medium')">Medium</button>
                <button class="pill" id="alertLong" onclick="setAlertDistance('long')">Long</button>
            </div>
        </div>
        <div class="setting-row">
            <span>Audio</span>
            <label class="switch"><input type="checkbox" id="audioToggle" checked><span class="slider"></span></label>
        </div>
        <div class="setting-row">
            <span>Theme</span>
            <div class="setting-pills">
                <button class="pill active" id="themeAuto" onclick="setTheme('auto')">Auto</button>
                <button class="pill" id="themeDark" onclick="setTheme('dark')">Dark</button>
                <button class="pill" id="themeLight" onclick="setTheme('light')">Light</button>
            </div>
        </div>
    </div>
</div>

<!-- Hidden elements needed by modules -->
<div id="panel" style="display:none"></div>
<div id="routePicker" style="display:none"></div>
<div id="searchResults" style="display:none"></div>
<div id="loadingOverlay" style="display:none"><div id="loadingText"></div></div>
<div id="overlay" style="display:none"></div>
<div id="speedPicker" style="display:none"></div>
<div id="historyPanel" style="display:none"></div>
<div id="sharePanel" style="display:none"></div>

<!-- JS modules -->
<script src="js/utils.js"></script>
<script src="js/storage.js"></script>
<script src="js/settings.js"></script>
<script src="js/theme.js"></script>
<script src="js/audio.js"></script>
<script src="js/cameras.js"></script>
<script src="js/pins.js"></script>
<script src="js/waze.js"></script>
<script src="js/map.js"></script>
<script src="js/search.js"></script>
<script src="js/routing.js"></script>
<script src="js/gps.js"></script>
<script src="js/alerts.js"></script>
<script src="js/speed-limit.js"></script>
<script src="js/radar-map.js"></script>
<script src="js/hud.js"></script>
<script src="js/speed-trend.js"></script>
<script src="js/avg-speed-zones.js"></script>
<script src="js/history.js"></script>
<script src="js/share.js"></script>
<script src="js/route-picker.js"></script>
<script src="js/app.js"></script>
</body>
</html>
